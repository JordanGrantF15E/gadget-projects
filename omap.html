
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>OpenLayers Click Event Example</title>
<link rel="stylesheet" href="../openlayers/theme/default/style.css" type="text/css">
<link rel="stylesheet" href="style.css" type="text/css">
<script src="../openlayers/OpenLayers.js"></script>
<script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
<script type="text/javascript">

var firstlonlat;

OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {
	defaultHandlerOptions: {
		'single': true,
		'double': false,
		'pixelTolerance': 0,
		'stopSingle': false,
		'stopDouble': false
	},
	initialize: function(options) {
		this.handlerOptions = OpenLayers.Util.extend({}, this.defaultHandlerOptions);
		OpenLayers.Control.prototype.initialize.apply(this, arguments);
		this.handler = new OpenLayers.Handler.Click(this, {'click': this.trigger}, this.handlerOptions);
	},
	trigger: function(e) {
		var lonlat = map.getLonLatFromPixel(e.xy);

		$inputmode++;
		if ($inputmode==1) {
			$('#modewindow').replaceWith("set heading");
			$firstlat = lonlat.lat;
			$firstlon = lonlat.lon;
			firstlonlat = lonlat;
			$('#pointlat').val(lonlat.lat);
		};
		if ($inputmode==2) {
			$secondlat = lonlat.lat;
			$secondlon = lonlat.lon;
			var secondlonlat = lonlat;
			$hdg = OpenLayers.Spherical.computeHeading(firstlonlat,secondlonlat);
			
			$hdg = (-$hdg+360)%360;
			alert($hdg);
			$inputmode = 0;

			var destlonlat = OpenLayers.Util.destinationVincenty(firstlonlat,$hdg,5000);


		};	


	}
});

var map;
$inputmode = 0;
function init(){
	map = new OpenLayers.Map('map');
	var ol_wms = new OpenLayers.Layer.WMS( "OpenLayers WMS","http://vmap0.tiles.osgeo.org/wms/vmap0?", {layers: 'basic'} );
	var jpl_wms = new OpenLayers.Layer.WMS( "NASA Global Mosaic","http://t1.hypercube.telascience.org/cgi-bin/landsat7",{layers: "landsat7"});
	jpl_wms.setVisibility(false);
	map.addLayers([ol_wms, jpl_wms]);
	map.addControl(new OpenLayers.Control.LayerSwitcher());
	// map.setCenter(new OpenLayers.LonLat(0, 0), 0);
	map.zoomToMaxExtent();
	var click = new OpenLayers.Control.Click();
	map.addControl(click);
	
	map.events.register("mousemove", map, function(e) {
		var position = this.events.getMousePosition(e);
		var lonlat = map.getLonLatFromPixel(e.xy);
		
		OpenLayers.Util.getElement("coords").innerHTML = lonlat.lat;
	}); 

	click.activate();
}
</script>
</head>
<body onload="init()">
<h1 id="title">Click Event Example</h1>
<div id="tags">
click control, double, doubleclick, double-click, event, events,
propagation, light
</div>
<p id="shortdesc">
This example shows the use of the click handler and
getLonLatFromPixel functions to trigger events on mouse click.
</p>
<div id="modewindow">pick first point</div>
<div id="map" class="smallmap"></div>
<div id="coords" style="height: 1.5em;"></div>
<div>
<input id="pointlat"></input>
<input id="pointlon"></input>
</div>
<div id="docs">
<p>Using the Click handler allows you to (for example) catch clicks
without catching double clicks, something that standard browser
events don't do for you. (Try double clicking: you'll zoom in,
whereas using the browser click event, you would just get two
alerts.) This example click control shows you how to use it.</p>
</div>
</body>
</html>
